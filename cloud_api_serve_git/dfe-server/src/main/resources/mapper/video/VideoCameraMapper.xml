<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.df.server.mapper.video.VideoCameraMapper">

    <select id="countCamera" resultType="int">
        select count(*) from df_video_camera where sub_code = #{subCode,jdbcType=VARCHAR}
    </select>

    <select id="getPageList" resultType="com.df.server.vo.VideoCamera.VideoCameraInfoVO">
        select
        t1.*,
        t2.sub_name,
        t3.des as device_name
        from df_video_camera t1
        left join df_pub_substation t2 on t1.sub_code = t2.sub_code
        left join df_video_device t3 on t1.device_code = t3.code
        <where>
            <if test="subCode != null and subCode != ''">
                and t1.sub_code = #{subCode}
            </if>
            <if test="status != null">
                and t1.status = #{status}
            </if>
            <if test="cameraName != null and cameraName != ''">
                and t1.des like concat('%', #{cameraName}, '%')
            </if>
            <if test="deviceCode != null and deviceCode != ''">
                and t1.device_code = #{deviceCode}
            </if>
            <if test="type != null">
                and t1.type = #{type}
            </if>
        </where>
        order by t1.id desc
        limit #{start,jdbcType=INTEGER},#{size,jdbcType=INTEGER}
    </select>

    <select id="getPageTotal" resultType="java.lang.Integer">
        select
        count(*)
        from df_video_camera t1
        <where>
            <if test="subCode != null and subCode != ''">
                and t1.sub_code = #{subCode}
            </if>
            <if test="status != null">
                and t1.status = #{status}
            </if>
            <if test="cameraName != null and cameraName != ''">
                and t1.des like concat('%', #{cameraName}, '%')
            </if>
            <if test="deviceCode != null and deviceCode != ''">
                and t1.device_code = #{deviceCode}
            </if>
            <if test="type != null">
                and t1.type = #{type}
            </if>
        </where>
    </select>

    <select id="countCameraByCameraCode" resultType="int">
        select count(*) from df_video_camera where code = #{camCode,jdbcType=VARCHAR}
    </select>

    <select id="getByCode" resultType="com.df.server.entity.video.VideoCameraEntity">
        select * from df_video_camera where code = #{code,jdbcType=VARCHAR}
    </select>

    <insert id="insertCameraBatch">
        insert into df_video_camera
        (code, des, type, sub_code, channel, visible, device_code, css_name, css_chan, sip_code)
        values
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.code},#{item.des},#{item.type},#{item.subCode},#{item.channel},1,#{item.deviceCode},
            #{item.cssName},#{item.cssChan},#{item.sipCode})
        </foreach>
    </insert>

    <select id="exportCameras" resultType="com.df.server.dto.videoCamera.VideoCameraExcel">
        select t1.*
        from df_video_camera t1
        <where>
            <if test="subCode != null and subCode != ''">
                and t1.sub_code = #{subCode}
            </if>
            <if test="status != null">
                and t1.status = #{status}
            </if>
            <if test="cameraName != null and cameraName != ''">
                and t1.des like concat('%', #{cameraName}, '%')
            </if>
            <if test="deviceCode != null and deviceCode != ''">
                and t1.device_code = #{deviceCode}
            </if>
            <if test="type != null">
                and t1.type = #{type}
            </if>
        </where>
    </select>

    <delete id="clearCamera">
        delete from df_video_camera where sub_code= #{subCode,jdbcType=VARCHAR}
    </delete>
</mapper>